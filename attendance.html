<!DOCTYPE html>
<html lang="mr">
<head>
    <meta charset="UTF-8">
    <title>‡§π‡§ú‡•á‡§∞‡•Ä ‡§µ‡•ç‡§Ø‡§µ‡§∏‡•ç‡§•‡§æ‡§™‡§® - ‡§Ø‡§∂‡•ã‡§¶‡•Ä‡§™ ‡§ï‡•ç‡§≤‡§æ‡§∏‡•á‡§∏</title>
    <style>
        body { display: flex; font-family: 'Segoe UI', sans-serif; margin: 0; background: #f4f7f6; }
        .sidebar { width: 250px; background: #2c3e50; color: white; height: 100vh; padding: 20px; position: fixed; }
        .sidebar h2 { color: #3498db; text-align: center; }
        .sidebar a { display: block; color: white; padding: 15px; text-decoration: none; border-bottom: 1px solid #3e4f5f; transition: 0.3s; }
        .sidebar a:hover { background: #34495e; padding-left: 25px; }

        .main { margin-left: 280px; padding: 30px; width: calc(100% - 310px); }
        .card { background: white; padding: 25px; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); position: relative; }
        
        .lang-container { position: absolute; top: 20px; right: 25px; }
        .lang-btn { background: #3498db; color: white; border: none; padding: 5px 15px; border-radius: 4px; cursor: pointer; }

        .controls { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; background: #e8f4fd; padding: 15px; border-radius: 8px; }
        label { font-weight: bold; color: #333; }
        select, input[type="date"] { padding: 8px; border-radius: 5px; border: 1px solid #ccc; margin-left: 5px; margin-right: 15px; }
        
        table { width: 100%; border-collapse: collapse; background: white; margin-top: 10px; }
        th, td { border: 1px solid #ddd; padding: 12px; text-align: center; }
        th { background: #2c3e50; color: white; }
        tr:nth-child(even) { background-color: #f9f9f9; }

        .btn-save { background: #3498db; color: white; border: none; padding: 12px 25px; border-radius: 5px; cursor: pointer; font-size: 16px; font-weight: bold; transition: 0.3s; }
        .btn-save:hover { background: #2980b9; }
        
        .wa-btn { background: #25D366; color: white; border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer; font-weight: bold; display: flex; align-items: center; justify-content: center; gap: 5px; margin: 0 auto; }
        .auto-mode { background: #ffeb3b; padding: 6px 12px; border-radius: 20px; font-size: 13px; font-weight: bold; border: 1px solid #fbc02d; color: #333; }
        #loader { font-weight: bold; color: #e67e22; display: none; margin-left: 10px; }

        /* --- ‡§®‡§µ‡•Ä‡§® View ‡§¨‡§ü‡§£ ‡§Ü‡§£‡§ø Modal CSS --- */
        .view-btn { background: #34495e; color: white; border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer; font-weight: bold; }
        .modal { display: none; position: fixed; z-index: 1001; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); }
        .modal-content { background: white; margin: 10% auto; padding: 20px; border-radius: 10px; width: 400px; box-shadow: 0 5px 15px rgba(0,0,0,0.3); }
        .close-modal { float: right; font-size: 24px; cursor: pointer; color: red; }
        .history-table { width: 100%; margin-top: 15px; }
        .history-table th { background: #ecf0f1; color: #333; padding: 8px; }
        .p-status { color: green; font-weight: bold; }
        .a-status { color: red; font-weight: bold; }
    </style>
</head>
<body>

    <div class="sidebar">
        <h2 id="sideTitle">‡§Ø‡§∂‡•ã‡§¶‡•Ä‡§™ ‡§ï‡•ç‡§≤‡§æ‡§∏‡•á‡§∏</h2>
        <a href="dashboard.html" id="navNewAdm">üìù ‡§®‡§µ‡•Ä‡§® ‡§ç‡§°‡§Æ‡§ø‡§∂‡§®</a>
        <a href="inquiry.html" >üìû ‡§ö‡•å‡§ï‡§∂‡•Ä ‡§µ‡•ç‡§Ø‡§µ‡§∏‡•ç‡§•‡§æ‡§™‡§®</a>
        <a href="view-students.html" id="navStudentList">üìã ‡§µ‡§ø‡§¶‡•ç‡§Ø‡§æ‡§∞‡•ç‡§•‡•Ä ‡§Ø‡§æ‡§¶‡•Ä</a>
        <a href="attendance.html" style="background:#3498db" id="navAttendance">üìÖ ‡§π‡§ú‡•á‡§∞‡•Ä</a>
        <a href="results.html" id="navResults">üìä ‡§Æ‡§æ‡§∞‡•ç‡§ï ‡§Ö‡§™‡§°‡•á‡§ü</a>
        <a href="analytics.html" >üìà ‡§®‡§ø‡§ï‡§æ‡§≤ ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£</a>
        <a href="fees.html" id="navFees">üí∞ ‡§´‡•Ä ‡§∞‡•á‡§ï‡•â‡§∞‡•ç‡§°</a>
        <a href="expenses.html" id="navExpenses">üí∏ ‡§ñ‡§∞‡•ç‡§ö ‡§µ‡•ç‡§Ø‡§µ‡§∏‡•ç‡§•‡§æ‡§™‡§®</a>
        <a href="#" onclick="logout()" id="navLogout">üö™ Log Out</a>
    </div>

    <div class="main">
        <div class="card">
            <div class="lang-container">
                <button class="lang-btn" id="langBtn" onclick="toggleLang()">English</button>
            </div>

            <h2 id="pageTitle" style="color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 10px;">‡§¶‡•à‡§®‡§ø‡§ï ‡§π‡§ú‡•á‡§∞‡•Ä (Attendance Sheet)</h2>
            
            <div class="controls">
                <div>
                    <label id="lblDate">‡§§‡§æ‡§∞‡•Ä‡§ñ: </label>
                    <input type="date" id="attDate">
                    
                    <label id="lblClass"> ‡§µ‡§∞‡•ç‡§ó ‡§®‡§ø‡§µ‡§°‡§æ: </label>
                    <select id="classFilter" onchange="loadStudentsForAttendance()">
                        <option value="" id="optSelect">-- ‡§®‡§ø‡§µ‡§°‡§æ --</option>
                        <option value="5">‡•´ ‡§µ‡•Ä</option><option value="6">‡•¨ ‡§µ‡•Ä</option>
                        <option value="7">‡•≠ ‡§µ‡•Ä</option><option value="8">‡•Æ ‡§µ‡•Ä</option>
                        <option value="9">‡•Ø ‡§µ‡•Ä</option><option value="10">‡•ß‡•¶ ‡§µ‡•Ä</option>
                        <option value="11">‡•ß‡•ß ‡§µ‡•Ä</option><option value="12">‡•ß‡•® ‡§µ‡•Ä</option>
                    </select>
                    <span id="loader">‡§≤‡•ã‡§° ‡§π‡•ã‡§§ ‡§Ü‡§π‡•á...</span>
                </div>
                <div>
                    <label style="font-size: 12px;" id="lblAutoNotify">Auto-Notify</label>
                    <input type="checkbox" id="autoNotifyToggle" checked>
                    <span class="auto-mode">üîî ON</span>
                </div>
            </div>

            <table id="attendanceTable">
                <thead>
                    <tr>
                        <th>PRN</th>
                        <th id="thName">‡§µ‡§ø‡§¶‡•ç‡§Ø‡§æ‡§∞‡•ç‡§•‡•ç‡§Ø‡§æ‡§ö‡•á ‡§®‡§æ‡§µ</th>
                        <th id="thMark">‡§π‡§ú‡•á‡§∞‡•Ä ‡§≤‡§æ‡§µ‡§æ</th>
                        <th id="thNotify">‡§™‡§æ‡§≤‡§ï‡§æ‡§Ç‡§®‡§æ ‡§ï‡§≥‡§µ‡§æ</th>
                        <th>View</th>
                    </tr>
                </thead>
                <tbody id="attendanceRows">
                    <tr><td colspan="5" id="initialMsg">‡§ï‡•É‡§™‡§Ø‡§æ ‡§µ‡§∞‡•Ä‡§≤ ‡§µ‡§∞‡•ç‡§ó ‡§®‡§ø‡§µ‡§°‡§æ...</td></tr>
                </tbody>
            </table>

            <div style="margin-top: 25px; text-align: right;">
                <button class="btn-save" id="saveBtn" onclick="uploadAttendance()">‚úÖ ‡§π‡§ú‡•á‡§∞‡•Ä ‡§∏‡•á‡§µ‡•ç‡§π ‡§ï‡§∞‡§æ (Save)</button>
            </div>
        </div>
    </div>

    <div id="attModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal()">&times;</span>
            <h3 id="modalName">‡§µ‡§ø‡§¶‡•ç‡§Ø‡§æ‡§∞‡•ç‡§•‡•Ä ‡§π‡§ú‡•á‡§∞‡•Ä</h3>
            <div id="modalLoading" style="display:none; text-align:center;">‡§≤‡•ã‡§° ‡§π‡•ã‡§§ ‡§Ü‡§π‡•á...</div>
            <div style="max-height: 300px; overflow-y: auto;">
                <table class="history-table" border="1">
                    <thead>
                        <tr><th>‡§§‡§æ‡§∞‡•Ä‡§ñ</th><th>‡§∏‡•ç‡§•‡§ø‡§§‡•Ä</th></tr>
                    </thead>
                    <tbody id="historyData"></tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyiiRO8kIgpWoxfx7isU5g9DkkMVhRq9hKg4uvxWph7L1yAfSy5z0KGVbzOsi8IewOLhw/exec";
        let currentLang = sessionStorage.getItem("lang") || 'mr';

        const langData = {
            mr: {
                sideTitle: "‡§Ø‡§∂‡•ã‡§¶‡•Ä‡§™ ‡§ï‡•ç‡§≤‡§æ‡§∏‡•á‡§∏", navNewAdm: "üìù ‡§®‡§µ‡•Ä‡§® ‡§ç‡§°‡§Æ‡§ø‡§∂‡§®", navStudentList: "üìã ‡§µ‡§ø‡§¶‡•ç‡§Ø‡§æ‡§∞‡•ç‡§•‡•Ä ‡§Ø‡§æ‡§¶‡•Ä", navAttendance: "üìÖ ‡§π‡§ú‡•á‡§∞‡•Ä", navResults: "üìä ‡§®‡§ø‡§ï‡§æ‡§≤/‡§Æ‡§æ‡§∞‡•ç‡§ï", navFees: "üí∞ ‡§´‡•Ä ‡§∞‡•á‡§ï‡•â‡§∞‡•ç‡§°", navExpenses: "üí∏ ‡§ñ‡§∞‡•ç‡§ö ‡§µ‡•ç‡§Ø‡§µ‡§∏‡•ç‡§•‡§æ‡§™‡§®", navLogout: "üö™ Log Out",
                pageTitle: "‡§¶‡•à‡§®‡§ø‡§ï ‡§π‡§ú‡•á‡§∞‡•Ä (Attendance Sheet)", lblDate: "‡§§‡§æ‡§∞‡•Ä‡§ñ: ", lblClass: "‡§µ‡§∞‡•ç‡§ó ‡§®‡§ø‡§µ‡§°‡§æ: ", optSelect: "-- ‡§®‡§ø‡§µ‡§°‡§æ --", lblAutoNotify: "Auto-Notify", thName: "‡§µ‡§ø‡§¶‡•ç‡§Ø‡§æ‡§∞‡•ç‡§•‡•ç‡§Ø‡§æ‡§ö‡•á ‡§®‡§æ‡§µ", thMark: "‡§π‡§ú‡•á‡§∞‡•Ä ‡§≤‡§æ‡§µ‡§æ", thNotify: "‡§™‡§æ‡§≤‡§ï‡§æ‡§Ç‡§®‡§æ ‡§ï‡§≥‡§µ‡§æ", initialMsg: "‡§ï‡•É‡§™‡§Ø‡§æ ‡§µ‡§∞‡•Ä‡§≤ ‡§µ‡§∞‡•ç‡§ó ‡§®‡§ø‡§µ‡§°‡§æ...",
                loader: "‡§≤‡•ã‡§° ‡§π‡•ã‡§§ ‡§Ü‡§π‡•á...", present: "‡§π‡§ú‡§∞", absent: "‡§ó‡•à‡§∞‡§π‡§ú‡§∞", saveBtn: "‚úÖ ‡§π‡§ú‡•á‡§∞‡•Ä ‡§∏‡•á‡§µ‡•ç‡§π ‡§ï‡§∞‡§æ (Save)", langBtn: "English",
                waMsg: "*‡§Ø‡§∂‡•ã‡§¶‡•Ä‡§™ ‡§ï‡•ç‡§≤‡§æ‡§∏‡•á‡§∏ - ‡§π‡§ú‡•á‡§∞‡•Ä ‡§Ö‡§™‡§°‡•á‡§ü*%0A%0A‡§®‡§Æ‡§∏‡•ç‡§ï‡§æ‡§∞, ‡§ï‡§≥‡§µ‡§£‡•ç‡§Ø‡§æ‡§§ ‡§Ø‡•á‡§§‡•á ‡§ï‡•Ä ‡§Ü‡§™‡§≤‡§æ ‡§Æ‡•Å‡§≤‡§ó‡§æ/‡§Æ‡•Å‡§≤‡§ó‡•Ä *{name}* ‡§Ü‡§ú ‡§¶‡§ø‡§®‡§æ‡§Ç‡§ï *{date}* ‡§∞‡•ã‡§ú‡•Ä ‡§ï‡•ç‡§≤‡§æ‡§∏‡§Æ‡§ß‡•ç‡§Ø‡•á *‡§ó‡•à‡§∞‡§π‡§ú‡§∞* ‡§Ü‡§π‡•á. ‡§ï‡•É‡§™‡§Ø‡§æ ‡§Ø‡§æ‡§ö‡•Ä ‡§®‡•ã‡§Ç‡§¶ ‡§ò‡•ç‡§Ø‡§æ‡§µ‡•Ä.",
                confirmWA: " ‡§µ‡§ø‡§¶‡•ç‡§Ø‡§æ‡§∞‡•ç‡§•‡•Ä ‡§ó‡•à‡§∞‡§π‡§ú‡§∞ ‡§Ü‡§π‡•á‡§§. ‡§§‡•ç‡§Ø‡§æ‡§Ç‡§®‡§æ WhatsApp ‡§Æ‡•á‡§∏‡•á‡§ú ‡§™‡§æ‡§†‡§µ‡§æ‡§Ø‡§ö‡•á ‡§ï‡§æ?", alertSuccess: "‡§π‡§ú‡•á‡§∞‡•Ä ‡§Ø‡§∂‡§∏‡•ç‡§µ‡•Ä‡§∞‡§ø‡§§‡•ç‡§Ø‡§æ ‡§∏‡•á‡§µ‡•ç‡§π ‡§ù‡§æ‡§≤‡•Ä!", alertSelect: "‡§Ü‡§ß‡•Ä ‡§µ‡§∞‡•ç‡§ó ‡§®‡§ø‡§µ‡§°‡§æ!"
            },
            en: {
                sideTitle: "Yashodeep Classes", navNewAdm: "üìù New Admission", navStudentList: "üìã Student List", navAttendance: "üìÖ Attendance", navResults: "üìä Marks/Results", navFees: "üí∞ Fees Record", navExpenses: "üí∏ Expenses", navLogout: "üö™ Log Out",
                pageTitle: "Daily Attendance Sheet", lblDate: "Date: ", lblClass: "Select Class: ", optSelect: "-- Select --", lblAutoNotify: "Auto-Notify", thName: "Student Name", thMark: "Mark Attendance", thNotify: "Notify Parent", initialMsg: "Please select a class...",
                loader: "Loading...", present: "Present", absent: "Absent", saveBtn: "‚úÖ Save Attendance", langBtn: "‡§Æ‡§∞‡§æ‡§†‡•Ä",
                waMsg: "*Yashodeep Classes - Attendance Update*%0A%0AHello, this is to inform you that your child *{name}* is *Absent* today ({date}). Please take note.",
                confirmWA: " students are absent. Send WhatsApp notifications?", alertSuccess: "Attendance saved successfully!", alertSelect: "Please select a class first!"
            }
        };

        document.addEventListener("DOMContentLoaded", function() {
            const isLoggedIn = sessionStorage.getItem("isLoggedIn");
            const role = sessionStorage.getItem("userRole");

            if (isLoggedIn !== "true") { window.location.href = "index.html"; return; }

            if (role === "md") {
                const feeLink = document.getElementById("navFees");
                const expLink = document.getElementById("navExpenses");
                if (feeLink) feeLink.style.display = "none";
                if (expLink) expLink.style.display = "none";
            }
            updateLanguageUI();
        });
        document.addEventListener("DOMContentLoaded", function() {
            const isLoggedIn = sessionStorage.getItem("isLoggedIn");
            if (isLoggedIn !== "true") { window.location.href = "index.html"; return; }
            document.getElementById('attDate').valueAsDate = new Date();
            updateLanguageUI();
        });

        function toggleLang() {
            currentLang = (currentLang === 'mr') ? 'en' : 'mr';
            sessionStorage.setItem("lang", currentLang);
            updateLanguageUI();
            loadStudentsForAttendance();
        }

        function updateLanguageUI() {
            const t = langData[currentLang];
            for (let id in t) {
                const el = document.getElementById(id);
                if (el) el.innerText = t[id];
            }
        }

        async function loadStudentsForAttendance() {
            const selectedClass = document.getElementById('classFilter').value;
            const tbody = document.getElementById('attendanceRows');
            const loader = document.getElementById('loader');
            const t = langData[currentLang];

            if (!selectedClass) { tbody.innerHTML = `<tr><td colspan="5">${t.initialMsg}</td></tr>`; return; }

            loader.style.display = "inline";
            try {
                const response = await fetch(`${SCRIPT_URL}?action=read&className=Class ${selectedClass}`);
                const data = await response.json();
                tbody.innerHTML = "";

                if (data.length === 0) {
                    tbody.innerHTML = `<tr><td colspan="5">No students found.</td></tr>`;
                    return;
                }

                data.forEach(student => {
                    const tr = document.createElement('tr');
                    tr.setAttribute('data-phone', student.parentPhone);
                    tr.innerHTML = `
                        <td>${student.prn}</td>
                        <td class="st-name">${student.name}</td>
                        <td>
                            <input type="radio" name="status_${student.prn}" value="P" checked> <span style="color: green; font-weight: bold;">${t.present}</span> 
                            <input type="radio" name="status_${student.prn}" value="A" style="margin-left: 10px;"> <span style="color: red; font-weight: bold;">${t.absent}</span>
                        </td>
                        <td>
                            <button class="wa-btn" onclick="sendWhatsApp('${student.name}', '${student.parentPhone}')">WhatsApp üì≤</button>
                        </td>
                        <td>
                            <button class="view-btn" onclick="showHistory('${student.prn}', '${student.name}')">üëÅ View</button>
                        </td>
                    `;
                    tbody.appendChild(tr);
                });
            } catch (error) { alert("Error loading list!"); }
            finally { loader.style.display = "none"; }
        }

        // --- ‡§®‡§µ‡•Ä‡§®: ‡§π‡§ú‡•á‡§∞‡•Ä ‡§á‡§§‡§ø‡§π‡§æ‡§∏ ‡§¶‡§æ‡§ñ‡§µ‡§£‡•ç‡§Ø‡§æ‡§∏‡§æ‡§†‡•Ä ‡§´‡§Ç‡§ï‡•ç‡§∂‡§® ---
        async function showHistory(prn, name) {
            document.getElementById('modalName').innerText = name + " - ‡§π‡§ú‡•á‡§∞‡•Ä ‡§á‡§§‡§ø‡§π‡§æ‡§∏";
            document.getElementById('attModal').style.display = "block";
            const tableBody = document.getElementById('historyData');
            const loader = document.getElementById('modalLoading');
            
            tableBody.innerHTML = "";
            loader.style.display = "block";

            try {
                const res = await fetch(`${SCRIPT_URL}?action=getHistory&prn=${prn}`);
                const history = await res.json();
                loader.style.display = "none";

                if (history.length === 0) {
                    tableBody.innerHTML = "<tr><td colspan='2'>‡§∞‡•á‡§ï‡•â‡§∞‡•ç‡§° ‡§∏‡§æ‡§™‡§°‡§≤‡§æ ‡§®‡§æ‡§π‡•Ä</td></tr>";
                } else {
                    history.forEach(row => {
                        const statusClass = row.status === 'P' ? 'p-status' : 'a-status';
                        const statusText = row.status === 'P' ? '‡§π‡§ú‡§∞' : '‡§ó‡•à‡§∞‡§π‡§ú‡§∞';
                        tableBody.innerHTML += `<tr><td>${row.date}</td><td class="${statusClass}">${statusText}</td></tr>`;
                    });
                }
            } catch (e) {
                loader.style.display = "none";
                alert("‡§°‡•á‡§ü‡§æ ‡§Æ‡§ø‡§≥‡§µ‡§§‡§æ‡§®‡§æ ‡§§‡•ç‡§∞‡•Å‡§ü‡•Ä ‡§Ü‡§≤‡•Ä!");
            }
        }

        function closeModal() {
            document.getElementById('attModal').style.display = "none";
        }

        async function uploadAttendance() {
            const t = langData[currentLang];
            const btn = document.getElementById('saveBtn');
            const className = document.getElementById('classFilter').value;
            const date = document.getElementById('attDate').value;
            const rows = document.querySelectorAll('#attendanceRows tr');
            const isAutoNotify = document.getElementById('autoNotifyToggle').checked;

            if (!className || rows.length === 0 || rows[0].cells.length < 2) { 
                alert(t.alertSelect); 
                return; 
            }

            let records = [];
            let absentStudents = [];

            rows.forEach(row => {
                const prn = row.cells[0].innerText;
                const name = row.querySelector('.st-name').innerText;
                const phone = row.getAttribute('data-phone');
                const status = row.querySelector(`input[name="status_${prn}"]:checked`).value;
                records.push({ prn, name, status });
                if (status === "A") absentStudents.push({ name, phone });
            });

            btn.disabled = true;
            btn.innerText = (currentLang === 'mr') ? "‡§∏‡•á‡§µ‡•ç‡§π ‡§π‡•ã‡§§ ‡§Ü‡§π‡•á..." : "Saving...";

            try {
                await fetch(SCRIPT_URL, {
                    method: 'POST',
                    body: JSON.stringify({ 
                        type: "Attendance", 
                        date: date, 
                        className: "Class " + className, 
                        records: records 
                    })
                });

                alert(t.alertSuccess);

                if (isAutoNotify && absentStudents.length > 0) {
                    absentStudents.forEach((st, idx) => {
                        setTimeout(() => {
                            sendWhatsApp(st.name, st.phone);
                        }, idx * 2000);
                    });
                }
            } catch (err) { 
                alert("Error: " + err); 
            } finally {
                btn.disabled = false;
                btn.innerText = t.saveBtn;
            }
        }

        function sendWhatsApp(name, phone) {
            const t = langData[currentLang];
            let date = document.getElementById('attDate').value;
            let formattedDate = new Date(date).toLocaleDateString(currentLang === 'mr' ? 'mr-IN' : 'en-IN');
            let message = t.waMsg.replace("{name}", name).replace("{date}", formattedDate);
            let cleanPhone = phone ? phone.toString().replace(/\D/g, '') : "";
            if (cleanPhone.length === 10) cleanPhone = "91" + cleanPhone;
            window.open(`https://wa.me/${cleanPhone}?text=${message}`, '_blank');
        }

        function logout() { sessionStorage.clear(); window.location.href = "index.html"; }
        // --- Keyboard Navigation Script Starts ---
document.addEventListener('keydown', function(e) {
    const active = document.activeElement;
    // ‡§´‡§ï‡•ç‡§§ Input, Select, Textarea ‡§Ü‡§£‡§ø Button ‡§µ‡§∞‡§ö ‡§π‡•á ‡§ï‡§æ‡§Æ ‡§ï‡§∞‡•á‡§≤
    if (!['INPUT', 'SELECT', 'TEXTAREA', 'BUTTON'].includes(active.tagName)) return;

    // ‡§´‡•â‡§∞‡•ç‡§Æ ‡§Æ‡§ß‡•Ä‡§≤ ‡§∏‡§∞‡•ç‡§µ ‡§ò‡§ü‡§ï‡§æ‡§Ç‡§ö‡•Ä ‡§Ø‡§æ‡§¶‡•Ä (‡§∏‡•ç‡§ï‡§ø‡§™ ‡§® ‡§ï‡§∞‡§§‡§æ)
    const focusableEls = Array.from(document.querySelectorAll('input, select, textarea, button:not(.lang-btn)'));
    const index = focusableEls.indexOf(active);

    switch(e.key) {
        case 'ArrowDown':
            e.preventDefault();
            if (index + 2 < focusableEls.length) focusableEls[index + 2].focus(); // ‡§ó‡•ç‡§∞‡§ø‡§°‡§Æ‡§ß‡•ç‡§Ø‡•á ‡§ñ‡§æ‡§≤‡•Ä ‡§ú‡§æ‡§£‡•ç‡§Ø‡§æ‡§∏‡§æ‡§†‡•Ä
            else if (index + 1 < focusableEls.length) focusableEls[index + 1].focus();
            break;
            
        case 'ArrowUp':
            e.preventDefault();
            if (index - 2 >= 0) focusableEls[index - 2].focus(); // ‡§ó‡•ç‡§∞‡§ø‡§°‡§Æ‡§ß‡•ç‡§Ø‡•á ‡§µ‡§∞ ‡§ú‡§æ‡§£‡•ç‡§Ø‡§æ‡§∏‡§æ‡§†‡•Ä
            else if (index - 1 >= 0) focusableEls[index - 1].focus();
            break;
            
        case 'ArrowRight':
            e.preventDefault();
            if (index + 1 < focusableEls.length) focusableEls[index + 1].focus();
            break;
            
        case 'ArrowLeft':
            e.preventDefault();
            if (index - 1 >= 0) focusableEls[index - 1].focus();
            break;

        case 'Enter':
            // ‡§ú‡§∞ ‡§¨‡§ü‡§£ ‡§Ö‡§∏‡•á‡§≤ ‡§§‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§π‡•ã‡§à‡§≤, ‡§Ö‡§®‡•ç‡§Ø‡§•‡§æ ‡§™‡•Å‡§¢‡§ö‡•ç‡§Ø‡§æ ‡§¨‡•â‡§ï‡•ç‡§∏‡§Æ‡§ß‡•ç‡§Ø‡•á ‡§ú‡§æ‡§à‡§≤
            if (active.tagName !== 'BUTTON' && active.tagName !== 'TEXTAREA') {
                e.preventDefault();
                if (index + 1 < focusableEls.length) focusableEls[index + 1].focus();
            }
            break;
    }
});
// --- Keyboard Navigation Script Ends ---
    </script>
</body>
</html>