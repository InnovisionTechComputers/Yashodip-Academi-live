<!DOCTYPE html>
<html lang="mr">
<head>
    <meta charset="UTF-8">
    <title>рдЪреМрдХрд╢реА рд╡реНрдпрд╡рд╕реНрдерд╛рдкрди - рдпрд╢реЛрджреАрдк рдХреНрд▓рд╛рд╕реЗрд╕</title>
    <style>
        body { display: flex; font-family: 'Segoe UI', sans-serif; margin: 0; background: #f4f7f6; }
        .sidebar h2 { color: #3498db; text-align: center; }
        .sidebar { width: 250px; background: #2c3e50; color: white; height: 100vh; padding: 20px; position: fixed; }
        .sidebar a { display: block; color: white; padding: 15px; text-decoration: none; border-bottom: 1px solid #34495e; transition: 0.3s; }
        .main { margin-left: 280px; padding: 30px; width: calc(100% - 310px); }
        .grid-container { display: grid; grid-template-columns: 350px 1fr; gap: 20px; }
        .card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 5px 15px rgba(0,0,0,0.08); }
        .form-group { margin-bottom: 15px; }
        label { display: block; font-weight: bold; margin-bottom: 5px; font-size: 14px; }
        input, select, textarea { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; }
        .submit-btn { background: #e67e22; color: white; border: none; padding: 12px; width: 100%; border-radius: 6px; cursor: pointer; font-weight: bold; }
        .filter-section { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 10px; }
        table { width: 100%; border-collapse: collapse; font-size: 14px; }
        th, td { border: 1px solid #eee; padding: 10px; text-align: left; }
        th { background: #f8f9fa; position: sticky; top: 0; }
        .btn-adm { background: #27ae60; color: white; border: none; padding: 5px 8px; border-radius: 4px; cursor: pointer; font-size: 11px; }
    </style>
</head>
<body>

    <div class="sidebar">
        <h2 id="sideTitle">рдпрд╢реЛрджреАрдк рдХреНрд▓рд╛рд╕реЗрд╕</h2>
        <a href="dashboard.html"  id="navNewAdm">ЁЯУЭ рдирд╡реАрди рдНрдбрдорд┐рд╢рди</a>
        <a href="inquiry.html" style="background:#3498db">ЁЯУЮ рдЪреМрдХрд╢реА рд╡реНрдпрд╡рд╕реНрдерд╛рдкрди</a>
        <a href="view-students.html" id="navStudentList">ЁЯУЛ рд╡рд┐рджреНрдпрд╛рд░реНрдереА рдпрд╛рджреА</a>
        <a href="attendance.html" id="navAttendance">ЁЯУЕ рд╣рдЬреЗрд░реА</a>
        <a href="results.html" id="navResults">ЁЯУК рдорд╛рд░реНрдХ рдЕрдкрдбреЗрдЯ</a>
        <a href="analytics.html" id="navAnalytics">ЁЯУИ рдирд┐рдХрд╛рд▓ рд╡рд┐рд╢реНрд▓реЗрд╖рдг</a>
        <a href="fees.html" id="navFees">ЁЯТ░ рдлреА рд░реЗрдХреЙрд░реНрдб</a>
        <a href="expenses.html" id="navExpenses">ЁЯТ╕ рдЦрд░реНрдЪ рд╡реНрдпрд╡рд╕реНрдерд╛рдкрди</a>
        <a href="#" onclick="logout()" id="navLogout">ЁЯЪк Log Out</a>
    </div>

    <div class="main">
        <div class="grid-container">
            <div class="card">
                <h3 style="color: #e67e22; margin-top:0;">ЁЯУЮ рдирд╡реАрди рдЪреМрдХрд╢реА</h3>
                <form id="inquiryForm">
                    <div class="form-group"><label>рдкрд╛рд▓рдХрд╛рдВрдЪреЗ рдирд╛рд╡:</label><input type="text" id="parentName" required></div>
                    <div class="form-group"><label>рд╡рд┐рджреНрдпрд╛рд░реНрдереНрдпрд╛рдЪреЗ рдирд╛рд╡:</label><input type="text" id="studentName"></div>
                    <div class="form-group">
                        <label>рд╡рд░реНрдЧ:</label>
                        <select id="targetClass" required>
                            <option value="">-- рдирд┐рд╡рдбрд╛ --</option>
                            <script>for(let i=5; i<=12; i++) document.write(`<option value="${i}">${i} рд╡реА</option>`);</script>
                        </select>
                    </div>
                    <div class="form-group"><label>рдореЛрдмрд╛рдИрд▓:</label><input type="tel" id="phone" maxlength="10" required></div>
                    <div class="form-group"><label>рд╢реЗрд░рд╛:</label><textarea id="remark" rows="2"></textarea></div>
                    <button type="button" id="saveBtn" class="submit-btn" onclick="sendInquiry()">рд╕реЗрд╡реНрд╣ рдХрд░рд╛</button>
                </form>
            </div>

            <div class="card">
                <div class="filter-section">
                    <h3>ЁЯУЛ рдЪреМрдХрд╢реА рдпрд╛рджреА</h3>
                    <select id="classFilter" onchange="displayData()">
                        <option value="All">рд╕рд░реНрд╡ рд╡рд░реНрдЧ</option>
                        <script>for(let i=5; i<=12; i++) document.write(`<option value="${i}">${i} рд╡реА</option>`);</script>
                    </select>
                </div>
                <div style="overflow-y:auto; max-height:500px;">
                    <table>
                        <thead><tr><th>рддрд╛рд░реАрдЦ</th><th>рдирд╛рд╡</th><th>рд╡рд░реНрдЧ</th><th>рд╕рдВрдкрд░реНрдХ</th><th>рдХреГрддреА</th></tr></thead>
                        <tbody id="inquiryTableBody"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbz4pP4lOcUed91ijYjDbYgtCcbL6Ez8VY2FJFsY2KhTVWzVYozyUbM5uiG07prorls_Qg/exec";
        let allInquiries = [];

        // рез. рдЖрдзреА рдлрдВрдХреНрд╢рдиреНрд╕ рдбрд┐рдлрд╛рдЗрди рдХрд░реВрдпрд╛ (рдЬреЗрдгреЗрдХрд░реВрди рдмреНрд░рд╛рдЙрдЭрд░рд▓рд╛ рддреА рдЖрдзреА рд╕рд╛рдкрдбрддреАрд▓)
        function updateLanguageUI() {
            const lang = localStorage.getItem("lang") || "mr";
            const translations = {
                mr: {
                    sideTitle: "рдпрд╢реЛрджреАрдк рдХреНрд▓рд╛рд╕реЗрд╕",
                    navNewAdm: "ЁЯУЭ рдирд╡реАрди рдНрдбрдорд┐рд╢рди",
                    navStudentList: "ЁЯУЛ рд╡рд┐рджреНрдпрд╛рд░реНрдереА рдпрд╛рджреА",
                    navAttendance: "ЁЯУЕ рд╣рдЬреЗрд░реА",
                    navResults: "ЁЯУК рдорд╛рд░реНрдХ рдЕрдкрдбреЗрдЯ",
                    navAnalytics: "ЁЯУИ рдирд┐рдХрд╛рд▓ рд╡рд┐рд╢реНрд▓реЗрд╖рдг",
                    navFees: "ЁЯТ░ рдлреА рд░реЗрдХреЙрд░реНрдб",
                    navExpenses: "ЁЯТ╕ рдЦрд░реНрдЪ рд╡реНрдпрд╡рд╕реНрдерд╛рдкрди",
                    navLogout: "ЁЯЪк Log Out"
                },
                en: {
                    sideTitle: "Yashodeep Classes",
                    navNewAdm: "ЁЯУЭ New Admission",
                    navStudentList: "ЁЯУЛ Student List",
                    navAttendance: "ЁЯУЕ Attendance",
                    navResults: "ЁЯУК Update Marks",
                    navAnalytics: "ЁЯУИ Analytics",
                    navFees: "ЁЯТ░ Fees Record",
                    navExpenses: "ЁЯТ╕ Expense Mgmt",
                    navLogout: "ЁЯЪк Log Out"
                }
            };
            const t = translations[lang];
            if(document.getElementById('sideTitle')) document.getElementById('sideTitle').innerText = t.sideTitle;
            if(document.getElementById('navNewAdm')) document.getElementById('navNewAdm').innerText = t.navNewAdm;
            if(document.getElementById('navStudentList')) document.getElementById('navStudentList').innerText = t.navStudentList;
            if(document.getElementById('navAttendance')) document.getElementById('navAttendance').innerText = t.navAttendance;
            if(document.getElementById('navResults')) document.getElementById('navResults').innerText = t.navResults;
            if(document.getElementById('navAnalytics')) document.getElementById('navAnalytics').innerText = t.navAnalytics;
            if(document.getElementById('navFees')) document.getElementById('navFees').innerText = t.navFees;
            if(document.getElementById('navExpenses')) document.getElementById('navExpenses').innerText = t.navExpenses;
            if(document.getElementById('navLogout')) document.getElementById('navLogout').innerText = t.navLogout;
        }

        function logout() {
            if(confirm("рддреБрдореНрд╣рд╛рд▓рд╛ рдмрд╛рд╣реЗрд░ рдкрдбрд╛рдпрдЪреЗ рдЖрд╣реЗ рдХрд╛?")) {
                sessionStorage.clear();
                window.location.href = "index.html";
            }
        }

        // реи. рдЖрддрд╛ рдЗрд╡реНрд╣реЗрдВрдЯ рд▓рд┐рд╕рдирд░реНрд╕ рдЖрдгрд┐ рдмрд╛рдХреАрдЪреЗ рд▓реЙрдЬрд┐рдХ
        document.addEventListener("DOMContentLoaded", function() {
            const isLoggedIn = sessionStorage.getItem("isLoggedIn");
            const role = sessionStorage.getItem("userRole");

            if (isLoggedIn !== "true") { window.location.href = "index.html"; return; }

            if (role === "md") {
                const feeLink = document.getElementById("navFees");
                const expLink = document.getElementById("navExpenses");
                if (feeLink) feeLink.style.display = "none";
                if (expLink) expLink.style.display = "none";
            }
            updateLanguageUI(); // рдЖрддрд╛ рд╣реЗ рдлрдВрдХреНрд╢рди рдмреНрд░рд╛рдЙрдЭрд░рд▓рд╛ рд╕рд╛рдкрдбреЗрд▓
            fetchInquiries(); 
        });

        async function fetchInquiries() {
            try {
                const response = await fetch(`${SCRIPT_URL}?action=readInquiry`);
                allInquiries = await response.json();
                displayData();
            } catch (e) { console.error(e); }
        }

        function displayData() {
            const filter = document.getElementById('classFilter').value;
            const tableBody = document.getElementById('inquiryTableBody');
            tableBody.innerHTML = "";
            const filtered = filter === "All" ? allInquiries : allInquiries.filter(i => String(i.targetClass) === filter);

            filtered.reverse().forEach((item, index) => {
                const originalIndex = allInquiries.length - 1 - index; 
                tableBody.innerHTML += `
                    <tr>
                        <td>${item.date}</td>
                        <td><b>${item.parentName}</b><br>${item.studentName}</td>
                        <td>${item.targetClass} рд╡реА</td>
                        <td>${item.phone}</td>
                        <td>
                            <button class="btn-adm" onclick='goToAdmission(${JSON.stringify(item)})' title="рдкреНрд░рд╡реЗрд╢ рдШреНрдпрд╛">тЮХ</button>
                            <button onclick="deleteInquiry(${originalIndex})" 
                                style="background:#e74c3c; color:white; border:none; padding:5px 8px; border-radius:4px; cursor:pointer; font-size:11px;" title="рдХрд╛рдвреВрди рдЯрд╛рдХрд╛">
                                ЁЯЧСя╕П
                            </button>
                        </td>
                    </tr>`;
            });
        }

        async function deleteInquiry(index) {
            if (confirm("рд╣реА рдЪреМрдХрд╢реА рдХрд╛рдпрдордЪреА рдХрд╛рдвреВрди рдЯрд╛рдХрд╛рдпрдЪреА рдХрд╛?")) {
                const btn = event.target;
                btn.innerText = "...";
                btn.disabled = true;
                try {
                    await fetch(`${SCRIPT_URL}?action=deleteInquiry&index=${index + 1}`);
                    alert("рдЪреМрдХрд╢реА рдпрд╢рд╕реНрд╡реАрд░рд┐рддреНрдпрд╛ рдХрд╛рдврд▓реА рдЧреЗрд▓реА!");
                    fetchInquiries();
                } catch (e) {
                    alert("рддреНрд░реБрдЯреА рдЖрд▓реА!");
                    btn.disabled = false;
                    btn.innerText = "ЁЯЧСя╕П";
                }
            }
        }

        function sendInquiry() {
            const btn = document.getElementById('saveBtn');
            btn.disabled = true;
            const payload = {
                type: "Inquiry",
                parentName: document.getElementById('parentName').value,
                studentName: document.getElementById('studentName').value,
                targetClass: document.getElementById('targetClass').value,
                phone: document.getElementById('phone').value,
                remark: document.getElementById('remark').value
            };
            fetch(SCRIPT_URL, { method: "POST", mode: "no-cors", body: JSON.stringify(payload) })
            .then(() => { alert("рдиреЛрдВрдж рдЭрд╛рд▓реА!"); location.reload(); });
        }

        function goToAdmission(item) {
            sessionStorage.setItem("tempInquiry", JSON.stringify(item));
            window.location.href = "dashboard.html"; 
        }
        // --- Keyboard Navigation Script Starts ---
document.addEventListener('keydown', function(e) {
    const active = document.activeElement;
    // рдлрдХреНрдд Input, Select, Textarea рдЖрдгрд┐ Button рд╡рд░рдЪ рд╣реЗ рдХрд╛рдо рдХрд░реЗрд▓
    if (!['INPUT', 'SELECT', 'TEXTAREA', 'BUTTON'].includes(active.tagName)) return;

    // рдлреЙрд░реНрдо рдордзреАрд▓ рд╕рд░реНрд╡ рдШрдЯрдХрд╛рдВрдЪреА рдпрд╛рджреА (рд╕реНрдХрд┐рдк рди рдХрд░рддрд╛)
    const focusableEls = Array.from(document.querySelectorAll('input, select, textarea, button:not(.lang-btn)'));
    const index = focusableEls.indexOf(active);

    switch(e.key) {
        case 'ArrowDown':
            e.preventDefault();
            if (index + 2 < focusableEls.length) focusableEls[index + 2].focus(); // рдЧреНрд░рд┐рдбрдордзреНрдпреЗ рдЦрд╛рд▓реА рдЬрд╛рдгреНрдпрд╛рд╕рд╛рдареА
            else if (index + 1 < focusableEls.length) focusableEls[index + 1].focus();
            break;
            
        case 'ArrowUp':
            e.preventDefault();
            if (index - 2 >= 0) focusableEls[index - 2].focus(); // рдЧреНрд░рд┐рдбрдордзреНрдпреЗ рд╡рд░ рдЬрд╛рдгреНрдпрд╛рд╕рд╛рдареА
            else if (index - 1 >= 0) focusableEls[index - 1].focus();
            break;
            
        case 'ArrowRight':
            e.preventDefault();
            if (index + 1 < focusableEls.length) focusableEls[index + 1].focus();
            break;
            
        case 'ArrowLeft':
            e.preventDefault();
            if (index - 1 >= 0) focusableEls[index - 1].focus();
            break;

        case 'Enter':
            // рдЬрд░ рдмрдЯрдг рдЕрд╕реЗрд▓ рддрд░ рдХреНрд▓рд┐рдХ рд╣реЛрдИрд▓, рдЕрдиреНрдпрдерд╛ рдкреБрдврдЪреНрдпрд╛ рдмреЙрдХреНрд╕рдордзреНрдпреЗ рдЬрд╛рдИрд▓
            if (active.tagName !== 'BUTTON' && active.tagName !== 'TEXTAREA') {
                e.preventDefault();
                if (index + 1 < focusableEls.length) focusableEls[index + 1].focus();
            }
            break;
    }
});
// --- Keyboard Navigation Script Ends ---
    </script>
</body>
</html>