<!DOCTYPE html>
<html lang="mr">
<head>
    <meta charset="UTF-8">
    <title>‡§´‡•Ä ‡§µ‡•ç‡§Ø‡§µ‡§∏‡•ç‡§•‡§æ‡§™‡§® - ‡§Ø‡§∂‡•ã‡§¶‡•Ä‡§™ ‡§ï‡•ç‡§≤‡§æ‡§∏‡•á‡§∏</title>
    <style>
        body { display: flex; font-family: 'Segoe UI', sans-serif; margin: 0; background: #f0f2f5; }
        .sidebar { width: 250px; background: #2c3e50; color: white; height: 100vh; padding: 20px; position: fixed; }
        .sidebar h2 { color: #3498db; text-align: center; }
        .sidebar a { display: block; color: white; padding: 15px; text-decoration: none; border-bottom: 1px solid #3e4f5f; }
        .sidebar a:hover { background: #34495e; padding-left: 25px; transition: 0.3s; }
        
        .main { margin-left: 280px; padding: 30px; width: calc(100% - 310px); }
        .card { background: white; padding: 25px; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); position: relative; }
        
        .lang-container { position: absolute; top: 20px; right: 25px; }
        .lang-btn { background: #3498db; color: white; border: none; padding: 5px 15px; border-radius: 4px; cursor: pointer; }
        
        .stats { display: flex; gap: 20px; margin-bottom: 20px; }
        .box { background: white; padding: 20px; border-radius: 8px; flex: 1; text-align: center; box-shadow: 0 2px 5px rgba(0,0,0,0.1); border-top: 4px solid #3498db; }
        
        .filter-section { background: #e8f4fd; padding: 15px; border-radius: 8px; margin-bottom: 20px; display: flex; align-items: center; gap: 15px; }
        select { padding: 8px; border-radius: 5px; border: 1px solid #3498db; }
        
        table { width: 100%; background: white; border-collapse: collapse; margin-top: 10px; }
        th, td { border: 1px solid #ddd; padding: 12px; text-align: center; }
        th { background: #3498db; color: white; }
        tr:nth-child(even) { background-color: #f9f9f9; }
        
        .pay-btn { background: #27ae60; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; font-weight: bold; }
        .edit-fee-btn { background: #f39c12; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; font-weight: bold; margin-left: 5px; }
        .wa-btn { background: #25D366; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; font-weight: bold; margin-left: 5px; }
        .print-btn { background: #34495e; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; font-weight: bold; margin-left: 5px; }
        .loader { font-weight: bold; color: #e67e22; display: none; }

        @media print {
            body * { visibility: hidden; }
            #receipt-print-area, #receipt-print-area * { visibility: visible; }
            #receipt-print-area { position: absolute; left: 0; top: 0; width: 100%; display: block !important; border: 1px solid #000; padding: 20px; }
        }
    </style>
</head>
<body>

    <div id="receipt-print-area" style="display:none;">
        <h2 style="text-align:center;">‡§Ø‡§∂‡•ã‡§¶‡•Ä‡§™ ‡§ï‡•ç‡§≤‡§æ‡§∏‡•á‡§∏ - ‡§´‡•Ä ‡§™‡§æ‡§µ‡§§‡•Ä</h2>
        <hr>
        <p><b>‡§µ‡§ø‡§¶‡•ç‡§Ø‡§æ‡§∞‡•ç‡§•‡•ç‡§Ø‡§æ‡§ö‡•á ‡§®‡§æ‡§µ:</b> <span id="p-name"></span></p>
        <p><b>PRN:</b> <span id="p-prn"></span> | <b>‡§§‡§æ‡§∞‡•Ä‡§ñ:</b> <span id="p-date"></span></p>
        <p><b>‡§è‡§ï‡•Ç‡§£ ‡§´‡•Ä:</b> ‚Çπ <span id="p-total"></span></p>
        <p><b>‡§≠‡§∞‡§≤‡•á‡§≤‡•Ä ‡§´‡•Ä:</b> ‚Çπ <span id="p-paid"></span></p>
        <p><b>‡§¨‡§æ‡§ï‡•Ä ‡§´‡•Ä:</b> ‚Çπ <span id="p-pend"></span></p>
        <br><br><br>
        <p style="text-align:right;">‡§∂‡§ø‡§ï‡•ç‡§∑‡§ï/‡§™‡•ç‡§∞‡§∂‡§æ‡§∏‡§ï‡§æ‡§ö‡•Ä ‡§∏‡§π‡•Ä</p>
    </div>

    <div class="sidebar">
        <h2 id="sideTitle">‡§Ø‡§∂‡•ã‡§¶‡•Ä‡§™ ‡§ï‡•ç‡§≤‡§æ‡§∏‡•á‡§∏</h2>
        <a href="dashboard.html" id="navNewAdm">üìù ‡§®‡§µ‡•Ä‡§® ‡§ç‡§°‡§Æ‡§ø‡§∂‡§®</a>
      <a href="inquiry.html" >üìû ‡§ö‡•å‡§ï‡§∂‡•Ä ‡§µ‡•ç‡§Ø‡§µ‡§∏‡•ç‡§•‡§æ‡§™‡§®</a>
        <a href="view-students.html" id="navStudentList">üìã ‡§µ‡§ø‡§¶‡•ç‡§Ø‡§æ‡§∞‡•ç‡§•‡•Ä ‡§Ø‡§æ‡§¶‡•Ä</a>
        <a href="attendance.html" id="navAttendance">üìÖ ‡§π‡§ú‡•á‡§∞‡•Ä</a>
        <a href="results.html" id="navResults">üìä ‡§Æ‡§æ‡§∞‡•ç‡§ï ‡§Ö‡§™‡§°‡•á‡§ü</a>
        <a href="analytics.html" >üìà ‡§®‡§ø‡§ï‡§æ‡§≤ ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£</a>
        <a href="fees.html" style="background:#3498db" id="navFees">üí∞ ‡§´‡•Ä ‡§∞‡•á‡§ï‡•â‡§∞‡•ç‡§°</a>
        <a href="expenses.html" id="navExpenses">üí∏ ‡§ñ‡§∞‡•ç‡§ö ‡§µ‡•ç‡§Ø‡§µ‡§∏‡•ç‡§•‡§æ‡§™‡§®</a>
        <a href="#" onclick="logout()" id="navLogout">üö™ Log Out</a>
    </div>

    <div class="main">
        <div class="card">
            <div class="lang-container">
                <button class="lang-btn" id="langBtn" onclick="toggleLang()">English</button>
            </div>

            <div class="stats">
                <div class="box"><h3><span id="txtTotalColl">‡§è‡§ï‡•Ç‡§£ ‡§ú‡§Æ‡§æ (G):</span> <span id="totalCollectedDisplay">‚Çπ‡•¶</span></h3></div>
                <div class="box" style="color: red;"><h3><span id="txtTotalPend">‡§¨‡§æ‡§ï‡•Ä ‡§´‡•Ä:</span> <span id="totalPendingDisplay">‚Çπ‡•¶</span></h3></div>
            </div>

            <div class="filter-section">
                <label><strong id="lblSelectClass">‡§µ‡§∞‡•ç‡§ó ‡§®‡§ø‡§µ‡§°‡§æ:</strong></label>
                <select id="feeClassFilter" onchange="loadFeeData()">
                    <option value="" id="optSelect">-- ‡§®‡§ø‡§µ‡§°‡§æ --</option>
                    <option value="5">‡•´ ‡§µ‡•Ä</option><option value="6">‡•¨ ‡§µ‡•Ä</option>
                    <option value="7">‡•≠ ‡§µ‡•Ä</option><option value="8">‡•Æ ‡§µ‡•Ä</option>
                    <option value="9">‡•Ø ‡§µ‡•Ä</option><option value="10">‡•ß‡•¶ ‡§µ‡•Ä</option>
                    <option value="11">‡•ß‡•ß ‡§µ‡•Ä</option><option value="12">‡•ß‡•® ‡§µ‡•Ä</option>
                </select>
                <button class="edit-btn" style="background:#f39c12; color:white; border:none; padding:8px 12px; border-radius:4px; cursor:pointer;" onclick="updateClassTotalFee()">‚úèÔ∏è ‡§µ‡§∞‡•ç‡§ó‡§æ‡§ö‡•Ä ‡§´‡•Ä ‡§∏‡•á‡§ü ‡§ï‡§∞‡§æ (H)</button>
                <span id="loader" class="loader">‡§≤‡•ã‡§° ‡§π‡•ã‡§§ ‡§Ü‡§π‡•á...</span>
            </div>

            <h2 id="tableTitle">‡§µ‡§ø‡§¶‡•ç‡§Ø‡§æ‡§∞‡•ç‡§•‡•Ä ‡§´‡•Ä ‡§§‡§™‡§∂‡•Ä‡§≤</h2>
            <table>
                <thead>
                    <tr>
                        <th>PRN</th>
                        <th id="thName">‡§®‡§æ‡§µ</th>
                        <th id="thTotal">‡§è‡§ï‡•Ç‡§£ ‡§´‡•Ä (H)</th>
                        <th id="thPaid">‡§≠‡§∞‡§≤‡•á‡§≤‡•Ä ‡§´‡•Ä (G)</th>
                        <th id="thPend">‡§¨‡§æ‡§ï‡•Ä ‡§´‡•Ä</th>
                        <th id="thAction">‡§ï‡•É‡§§‡•Ä</th>
                    </tr>
                </thead>
                <tbody id="feeTableBody">
                    <tr><td colspan="6" id="initialMsg">‡§ï‡•É‡§™‡§Ø‡§æ ‡§µ‡§∞‡•Ä‡§≤ ‡§µ‡§∞‡•ç‡§ó ‡§®‡§ø‡§µ‡§°‡§æ...</td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // ‡§§‡•Å‡§Æ‡§ö‡•Ä ‡§®‡§µ‡•Ä‡§® ‡§Ö‡§™‡§°‡•á‡§ü‡•á‡§° URL
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzTVVP-dZMsRu4_Z_MTLirypeWiDT_EwyZSOQ_L0pYrh_LFTM4rG_EeMpvLQcg9P5GtRQ/exec";
        
        let currentLang = sessionStorage.getItem("lang") || 'mr';

        const langData = {
            mr: {
                sideTitle: "‡§Ø‡§∂‡•ã‡§¶‡•Ä‡§™ ‡§ï‡•ç‡§≤‡§æ‡§∏‡•á‡§∏", navNewAdm: "üìù ‡§®‡§µ‡•Ä‡§® ‡§ç‡§°‡§Æ‡§ø‡§∂‡§®", navStudentList: "üìã ‡§µ‡§ø‡§¶‡•ç‡§Ø‡§æ‡§∞‡•ç‡§•‡•Ä ‡§Ø‡§æ‡§¶‡•Ä", navAttendance: "üìÖ ‡§π‡§ú‡•á‡§∞‡•Ä", navFees: "üí∞ ‡§´‡•Ä ‡§∞‡•á‡§ï‡•â‡§∞‡•ç‡§°", navResults: "üìä ‡§®‡§ø‡§ï‡§æ‡§≤/‡§Æ‡§æ‡§∞‡•ç‡§ï", navExpenses: "üí∏ ‡§ñ‡§∞‡•ç‡§ö ‡§µ‡•ç‡§Ø‡§µ‡§∏‡•ç‡§•‡§æ‡§™‡§®", navLogout: "üö™ Log Out",
                txtTotalColl: "‡§è‡§ï‡•Ç‡§£ ‡§ú‡§Æ‡§æ (G): ", txtTotalPend: "‡§¨‡§æ‡§ï‡•Ä ‡§´‡•Ä: ", lblSelectClass: "‡§µ‡§∞‡•ç‡§ó ‡§®‡§ø‡§µ‡§°‡§æ:", optSelect: "-- ‡§®‡§ø‡§µ‡§°‡§æ --", tableTitle: "‡§µ‡§ø‡§¶‡•ç‡§Ø‡§æ‡§∞‡•ç‡§•‡•Ä ‡§´‡•Ä ‡§§‡§™‡§∂‡•Ä‡§≤",
                thName: "‡§®‡§æ‡§µ", thTotal: "‡§è‡§ï‡•Ç‡§£ ‡§´‡•Ä (H)", thPaid: "‡§≠‡§∞‡§≤‡•á‡§≤‡•Ä ‡§´‡•Ä (G)", thPend: "‡§¨‡§æ‡§ï‡•Ä ‡§´‡•Ä", thAction: "‡§ï‡•É‡§§‡•Ä",
                initialMsg: "‡§ï‡•É‡§™‡§Ø‡§æ ‡§µ‡§∞‡•Ä‡§≤ ‡§µ‡§∞‡•ç‡§ó ‡§®‡§ø‡§µ‡§°‡§æ...", btnPay: "üí∞ ‡§ú‡§Æ‡§æ", btnEdit: "‚úèÔ∏è ‡§¨‡§¶‡§≤", alertError: "‡§§‡•ç‡§∞‡•Å‡§ü‡•Ä ‡§Ü‡§≤‡•Ä!", 
                waMsg: "*‡§Ø‡§∂‡•ã‡§¶‡•Ä‡§™ ‡§ï‡•ç‡§≤‡§æ‡§∏‡•á‡§∏ - ‡§´‡•Ä ‡§∞‡§ø‡§Æ‡§æ‡§á‡§®‡•ç‡§°‡§∞*%0A%0A‡§®‡§Æ‡§∏‡•ç‡§ï‡§æ‡§∞, ‡§ï‡§≥‡§µ‡§£‡•ç‡§Ø‡§æ‡§§ ‡§Ø‡•á‡§§‡•á ‡§ï‡•Ä ‡§Ü‡§™‡§≤‡§æ ‡§Æ‡•Å‡§≤‡§ó‡§æ/‡§Æ‡•Å‡§≤‡§ó‡•Ä *{name}* ‡§Ø‡§æ‡§ö‡•Ä ‡§ï‡•ç‡§≤‡§æ‡§∏‡§ö‡•Ä *‚Çπ{amount}* ‡§´‡•Ä ‡§¨‡§æ‡§ï‡•Ä ‡§Ü‡§π‡•á. ‡§ï‡•É‡§™‡§Ø‡§æ ‡§ú‡§Æ‡§æ ‡§ï‡§∞‡§æ‡§µ‡•Ä.", langBtn: "English"
            },
            en: {
                sideTitle: "Yashodeep Classes", navNewAdm: "üìù New Admission", navStudentList: "üìã Student List", navAttendance: "üìÖ Attendance", navFees: "üí∞ Fee Records", navResults: "üìä Marks/Results", navExpenses: "üí∏ Expenses", navLogout: "üö™ Log Out",
                txtTotalColl: "Total Collected (G): ", txtTotalPend: "Total Pending: ", lblSelectClass: "Select Class:", optSelect: "-- Select --", tableTitle: "Student Fee Details",
                thName: "Name", thTotal: "Total (H)", thPaid: "Paid (G)", thPend: "Pending", thAction: "Action",
                initialMsg: "Please select a class...", btnPay: "üí∞ Add", btnEdit: "‚úèÔ∏è Edit", alertError: "Error occurred!", 
                waMsg: "*Yashodeep Classes - Fee Reminder*%0A%0AHello, child *{name}* has a pending fee of *‚Çπ{amount}*. Kindly deposit.", langBtn: "‡§Æ‡§∞‡§æ‡§†‡•Ä"
            }
        };

        document.addEventListener("DOMContentLoaded", () => {
            if (sessionStorage.getItem("isLoggedIn") !== "true") { window.location.href = "index.html"; return; }
            updateLanguageUI();
        });

        function toggleLang() {
            currentLang = (currentLang === 'mr') ? 'en' : 'mr';
            sessionStorage.setItem("lang", currentLang);
            updateLanguageUI();
            loadFeeData();
        }

        function updateLanguageUI() {
            const t = langData[currentLang];
            for (let id in t) {
                const el = document.getElementById(id);
                if (el) el.innerText = t[id];
            }
        }

        async function loadFeeData() {
            const cls = document.getElementById('feeClassFilter').value;
            const tableBody = document.getElementById('feeTableBody');
            const loader = document.getElementById('loader');
            const t = langData[currentLang];

            if (!cls) { tableBody.innerHTML = `<tr><td colspan="6">${t.initialMsg}</td></tr>`; return; }
            loader.style.display = "inline";

            try {
                // Action = read ‡§µ‡§æ‡§™‡§∞‡•Ç‡§® ‡§°‡•á‡§ü‡§æ ‡§Æ‡§ø‡§≥‡§µ‡§£‡•á
                const response = await fetch(`${SCRIPT_URL}?action=read&className=Class ${cls}`);
                const data = await response.json();
                let totalColl = 0, totalPend = 0;
                tableBody.innerHTML = "";

                data.forEach(student => {
                    let h_total = Number(student.totalFee) || 0; 
                    let g_paid = Number(student.paid) || 0; 
                    let pending = h_total - g_paid;
                    totalColl += g_paid; totalPend += pending;

                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${student.prn}</td>
                        <td>${student.name}</td>
                        <td style="font-weight:bold;">‚Çπ ${h_total}</td>
                        <td style="color:blue;">‚Çπ ${g_paid}</td>
                        <td style="color:${pending > 0 ? 'red' : 'green'}; font-weight:bold;">‚Çπ ${pending}</td>
                        <td>
                            <button class="pay-btn" title="‡§´‡•Ä ‡§ú‡§Æ‡§æ ‡§ï‡§∞‡§æ" onclick="collectFee('${student.prn}', '${student.name}')">${t.btnPay}</button>
                            <button class="edit-fee-btn" title="‡§≠‡§∞‡§≤‡•á‡§≤‡•Ä ‡§´‡•Ä ‡§è‡§°‡§ø‡§ü ‡§ï‡§∞‡§æ" onclick="editPaidFee('${student.prn}', '${student.name}', ${g_paid})">${t.btnEdit}</button>
                            <button class="print-btn" title="‡§™‡§æ‡§µ‡§§‡•Ä ‡§™‡•ç‡§∞‡§ø‡§Ç‡§ü ‡§ï‡§∞‡§æ" onclick="printInvoice('${student.name}', '${student.prn}', ${h_total}, ${g_paid}, ${pending})">üñ®Ô∏è</button>
                            ${pending > 0 ? `<button class="wa-btn" title="WhatsApp ‡§∞‡§ø‡§Æ‡§æ‡§á‡§®‡•ç‡§°‡§∞" onclick="sendFeeReminder('${student.name}', '${student.parentPhone}', '${pending}')">üì≤</button>` : ''}
                        </td>
                    `;
                    tableBody.appendChild(tr);
                });
                document.getElementById('totalCollectedDisplay').innerText = "‚Çπ" + totalColl;
                document.getElementById('totalPendingDisplay').innerText = "‚Çπ" + totalPend;
            } catch (error) { 
                console.error("Load Error:", error);
                alert("‡§°‡•á‡§ü‡§æ ‡§≤‡•ã‡§° ‡§ï‡§∞‡§§‡§æ ‡§Ü‡§≤‡§æ ‡§®‡§æ‡§π‡•Ä. ‡§ï‡•É‡§™‡§Ø‡§æ Google Script 'Deploy' ‡§Ü‡§£‡§ø 'Access: Anyone' ‡§Ö‡§∏‡§≤‡•ç‡§Ø‡§æ‡§ö‡•Ä ‡§ñ‡§æ‡§§‡•ç‡§∞‡•Ä ‡§ï‡§∞‡§æ."); 
            } 
            finally { loader.style.display = "none"; }
        }

        async function updateClassTotalFee() {
            const cls = document.getElementById('feeClassFilter').value;
            if (!cls) return alert("‡§Ü‡§ß‡•Ä ‡§µ‡§∞‡•ç‡§ó ‡§®‡§ø‡§µ‡§°‡§æ!");
            let newTotal = prompt(cls + " ‡§µ‡•Ä ‡§µ‡§∞‡•ç‡§ó‡§æ‡§∏‡§æ‡§†‡•Ä ‡§è‡§ï‡•Ç‡§£ ‡§´‡•Ä (Column H) ‡§ï‡§ø‡§§‡•Ä ‡§†‡•á‡§µ‡§æ‡§Ø‡§ö‡•Ä?");
            if (newTotal) {
                await fetch(SCRIPT_URL, {
                    method: 'POST', mode: 'no-cors',
                    body: JSON.stringify({ type: "UpdateClassTotalFee", className: "Class " + cls, newTotal: newTotal })
                });
                alert("‡§Ö‡§™‡§°‡•á‡§ü ‡§µ‡§ø‡§®‡§Ç‡§§‡•Ä ‡§™‡§æ‡§†‡§µ‡§≤‡•Ä!"); setTimeout(loadFeeData, 1500);
            }
        }

        async function collectFee(prn, name) {
            let amount = prompt(name + " ‡§ï‡§°‡•Ç‡§® ‡§ï‡§ø‡§§‡•Ä ‡§´‡•Ä ‡§ú‡§Æ‡§æ ‡§ù‡§æ‡§≤‡•Ä? (‡§π‡•Ä ‡§∞‡§ï‡•ç‡§ï‡§Æ ‡§∏‡§ß‡•ç‡§Ø‡§æ‡§ö‡•ç‡§Ø‡§æ ‡§∞‡§ï‡§Æ‡•á‡§§ ‡§Æ‡§ø‡§≥‡§µ‡§≤‡•Ä ‡§ú‡§æ‡§à‡§≤):");
            if (amount) {
                await fetch(SCRIPT_URL, {
                    method: 'POST', mode: 'no-cors',
                    body: JSON.stringify({ type: "CollectFee", prn: prn, className: "Class " + document.getElementById('feeClassFilter').value, amount: amount })
                });
                alert("‡§´‡•Ä ‡§ú‡§Æ‡§æ ‡§ï‡§∞‡§£‡•ç‡§Ø‡§æ‡§ö‡•Ä ‡§µ‡§ø‡§®‡§Ç‡§§‡•Ä ‡§™‡§æ‡§†‡§µ‡§≤‡•Ä!"); setTimeout(loadFeeData, 1500);
            }
        }

        async function editPaidFee(prn, name, currentPaid) {
            let newPaid = prompt(name + " ‡§∏‡§æ‡§†‡•Ä ‡§≠‡§∞‡§≤‡•á‡§≤‡•Ä ‡§®‡§µ‡•Ä‡§® ‡§è‡§ï‡•Ç‡§£ ‡§´‡•Ä (Total Paid) ‡§ü‡§æ‡§ï‡§æ:", currentPaid);
            if (newPaid !== null && newPaid !== "") {
                await fetch(SCRIPT_URL, {
                    method: 'POST', mode: 'no-cors',
                    body: JSON.stringify({ 
                        type: "EditPaidFee", 
                        prn: prn, 
                        className: "Class " + document.getElementById('feeClassFilter').value, 
                        newAmount: newPaid 
                    })
                });
                alert("‡§´‡•Ä ‡§¶‡•Å‡§∞‡•Å‡§∏‡•ç‡§§ ‡§ï‡§∞‡§£‡•ç‡§Ø‡§æ‡§ö‡•Ä ‡§µ‡§ø‡§®‡§Ç‡§§‡•Ä ‡§™‡§æ‡§†‡§µ‡§≤‡•Ä!"); setTimeout(loadFeeData, 1500);
            }
        }

        function printInvoice(name, prn, total, paid, pend) {
            document.getElementById('p-name').innerText = name;
            document.getElementById('p-prn').innerText = prn;
            document.getElementById('p-total').innerText = total;
            document.getElementById('p-paid').innerText = paid;
            document.getElementById('p-pend').innerText = pend;
            document.getElementById('p-date').innerText = new Date().toLocaleDateString();
            window.print();
        }

        function sendFeeReminder(name, phone, amount) {
            let message = langData[currentLang].waMsg.replace("{name}", name).replace("{amount}", amount);
            window.open(`https://wa.me/91${phone}?text=${message}`, '_blank');
        }

        function logout() { sessionStorage.clear(); window.location.href = "index.html"; }
        // --- Keyboard Navigation Script Starts ---
document.addEventListener('keydown', function(e) {
    const active = document.activeElement;
    // ‡§´‡§ï‡•ç‡§§ Input, Select, Textarea ‡§Ü‡§£‡§ø Button ‡§µ‡§∞‡§ö ‡§π‡•á ‡§ï‡§æ‡§Æ ‡§ï‡§∞‡•á‡§≤
    if (!['INPUT', 'SELECT', 'TEXTAREA', 'BUTTON'].includes(active.tagName)) return;

    // ‡§´‡•â‡§∞‡•ç‡§Æ ‡§Æ‡§ß‡•Ä‡§≤ ‡§∏‡§∞‡•ç‡§µ ‡§ò‡§ü‡§ï‡§æ‡§Ç‡§ö‡•Ä ‡§Ø‡§æ‡§¶‡•Ä (‡§∏‡•ç‡§ï‡§ø‡§™ ‡§® ‡§ï‡§∞‡§§‡§æ)
    const focusableEls = Array.from(document.querySelectorAll('input, select, textarea, button:not(.lang-btn)'));
    const index = focusableEls.indexOf(active);

    switch(e.key) {
        case 'ArrowDown':
            e.preventDefault();
            if (index + 2 < focusableEls.length) focusableEls[index + 2].focus(); // ‡§ó‡•ç‡§∞‡§ø‡§°‡§Æ‡§ß‡•ç‡§Ø‡•á ‡§ñ‡§æ‡§≤‡•Ä ‡§ú‡§æ‡§£‡•ç‡§Ø‡§æ‡§∏‡§æ‡§†‡•Ä
            else if (index + 1 < focusableEls.length) focusableEls[index + 1].focus();
            break;
            
        case 'ArrowUp':
            e.preventDefault();
            if (index - 2 >= 0) focusableEls[index - 2].focus(); // ‡§ó‡•ç‡§∞‡§ø‡§°‡§Æ‡§ß‡•ç‡§Ø‡•á ‡§µ‡§∞ ‡§ú‡§æ‡§£‡•ç‡§Ø‡§æ‡§∏‡§æ‡§†‡•Ä
            else if (index - 1 >= 0) focusableEls[index - 1].focus();
            break;
            
        case 'ArrowRight':
            e.preventDefault();
            if (index + 1 < focusableEls.length) focusableEls[index + 1].focus();
            break;
            
        case 'ArrowLeft':
            e.preventDefault();
            if (index - 1 >= 0) focusableEls[index - 1].focus();
            break;

        case 'Enter':
            // ‡§ú‡§∞ ‡§¨‡§ü‡§£ ‡§Ö‡§∏‡•á‡§≤ ‡§§‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§π‡•ã‡§à‡§≤, ‡§Ö‡§®‡•ç‡§Ø‡§•‡§æ ‡§™‡•Å‡§¢‡§ö‡•ç‡§Ø‡§æ ‡§¨‡•â‡§ï‡•ç‡§∏‡§Æ‡§ß‡•ç‡§Ø‡•á ‡§ú‡§æ‡§à‡§≤
            if (active.tagName !== 'BUTTON' && active.tagName !== 'TEXTAREA') {
                e.preventDefault();
                if (index + 1 < focusableEls.length) focusableEls[index + 1].focus();
            }
            break;
    }
});
// --- Keyboard Navigation Script Ends ---
    </script>
</body>
</html>