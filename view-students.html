<!DOCTYPE html>
<html lang="mr">
<head>
    <meta charset="UTF-8">
    <title>рд╡рд┐рджреНрдпрд╛рд░реНрдереА рдпрд╛рджреА - рдпрд╢реЛрджреАрдк рдХреНрд▓рд╛рд╕реЗрд╕</title>
    <style>
        body { display: flex; font-family: 'Segoe UI', sans-serif; margin: 0; background: #f0f2f5; }
        .sidebar { width: 250px; background: #2c3e50; color: white; height: 100vh; padding: 20px; position: fixed; }
        .sidebar h2 { color: #3498db; text-align: center; }
        .sidebar a { display: block; color: white; padding: 15px; text-decoration: none; border-bottom: 1px solid #3e4f5f; }
        
        .main { margin-left: 280px; padding: 30px; width: calc(100% - 310px); }
        .card { background: white; padding: 25px; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); position: relative; }
        
        .lang-container { position: absolute; top: 20px; right: 25px; }
        .lang-btn { background: #3498db; color: white; border: none; padding: 5px 15px; border-radius: 4px; cursor: pointer; }

        .filter-section { margin-bottom: 20px; padding: 15px; background: #e8f4fd; border-radius: 8px; display: flex; align-items: center; gap: 15px; }
        select { padding: 8px; border-radius: 5px; border: 1px solid #3498db; font-size: 16px; }
        
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
        th { background-color: #3498db; color: white; }
        tr:nth-child(even) { background-color: #f2f2f2; }
        #loader { font-weight: bold; color: #e67e22; display: none; margin-left: 10px; }

        /* Delete Button Style */
        .btn-delete { background: #e74c3c; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; }
        .btn-delete:hover { background: #c0392b; }
    </style>
</head>
<body>

    <div class="sidebar">
        <h2 id="sideTitle">рдпрд╢реЛрджреАрдк рдХреНрд▓рд╛рд╕реЗрд╕</h2>
        <a href="dashboard.html"  id="navNewAdm">ЁЯУЭ рдирд╡реАрди рдНрдбрдорд┐рд╢рди</a>
        <a href="inquiry.html" >ЁЯУЮ рдЪреМрдХрд╢реА рд╡реНрдпрд╡рд╕реНрдерд╛рдкрди</a>
        <a href="view-students.html" style="background:#3498db" id="navStudentList">ЁЯУЛ рд╡рд┐рджреНрдпрд╛рд░реНрдереА рдпрд╛рджреА</a>
        <a href="attendance.html" id="navAttendance">ЁЯУЕ рд╣рдЬреЗрд░реА</a>
        <a href="results.html"  id="navResults">ЁЯУК рдирд┐рдХрд╛рд▓/рдорд╛рд░реНрдХ</a>
        <a href="analytics.html" >ЁЯУИ рдирд┐рдХрд╛рд▓ рд╡рд┐рд╢реНрд▓реЗрд╖рдг</a>
        <a href="fees.html" id="navFees">ЁЯТ░ рдлреА рд░реЗрдХреЙрд░реНрдб</a>
        <a href="expenses.html" id="navExpenses">ЁЯТ╕ рдЦрд░реНрдЪ рд╡реНрдпрд╡рд╕реНрдерд╛рдкрди</a>
        <a href="#" onclick="logout()" id="navLogout">ЁЯЪк Log Out</a>
    </div>

    <div class="main">
        <div class="card">
            <div class="lang-container">
                <button class="lang-btn" id="langBtn" onclick="toggleLang()">English</button>
            </div>

            <h2 id="pageTitle">рдиреЛрдВрджрдгреАрдХреГрдд рд╡рд┐рджреНрдпрд╛рд░реНрдереА рдпрд╛рджреА</h2>
            
            <div class="filter-section">
                <label><strong id="lblSelectClass">рд╡рд░реНрдЧрд╛рдиреБрд╕рд╛рд░ рдпрд╛рджреА рдкрд╣рд╛:</strong></label>
                <select id="classSelect" onchange="loadClassData()">
                    <option value="" id="optDefault">-- рд╡рд░реНрдЧ рдирд┐рд╡рдбрд╛ --</option>
                    <option value="5">рел рд╡реА</option><option value="6">рем рд╡реА</option>
                    <option value="7">рен рд╡реА</option><option value="8">рео рд╡реА</option>
                    <option value="9">реп рд╡реА</option><option value="10">резреж рд╡реА</option>
                    <option value="11">резрез рд╡реА</option><option value="12">резреи рд╡реА</option>
                </select>
                <span id="loader">рдорд╛рд╣рд┐рддреА рд▓реЛрдб рд╣реЛрдд рдЖрд╣реЗ...</span>
            </div>

            <table id="studentTable">
                <thead>
                    <tr>
                        <th>PRN</th>
                        <th id="thName">рдирд╛рд╡</th>
                        <th id="thParentPhone">рдкрд╛рд▓рдХрд╛рдВрдЪрд╛ рдлреЛрди</th>
                        <th id="thStudentPhone">рд╡рд┐рджреНрдпрд╛рд░реНрдереНрдпрд╛рдЪрд╛ рдлреЛрди</th> 
                        <th id="thDOB">рдЬрдиреНрдорддрд╛рд░реАрдЦ</th>
                        <th id="thAction">рдХреГрддреА</th> </tr>
                </thead>
                <tbody id="tableBody">
                    <tr>
                        <td colspan="6" style="text-align:center;" id="initialMsg">рдХреГрдкрдпрд╛ рд╡рд░реНрдЧ рдирд┐рд╡рдбрд╛...</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <script>
        let currentLang = sessionStorage.getItem("lang") || 'mr';

        const langData = {
            mr: {
                sideTitle: "рдпрд╢реЛрджреАрдк рдХреНрд▓рд╛рд╕реЗрд╕", navNewAdm: "ЁЯУЭ рдирд╡реАрди рдНрдбрдорд┐рд╢рди", navStudentList: "ЁЯУЛ рд╡рд┐рджреНрдпрд╛рд░реНрдереА рдпрд╛рджреА", navAttendance: "ЁЯУЕ рд╣рдЬреЗрд░реА", navResults: "ЁЯУК рдирд┐рдХрд╛рд▓/рдорд╛рд░реНрдХ", navFees: "ЁЯТ░ рдлреА рд░реЗрдХреЙрд░реНрдб", navExpenses: "ЁЯТ╕ рдЦрд░реНрдЪ рд╡реНрдпрд╡рд╕реНрдерд╛рдкрди", navLogout: "ЁЯЪк Log Out",
                pageTitle: "рдиреЛрдВрджрдгреАрдХреГрдд рд╡рд┐рджреНрдпрд╛рд░реНрдереА рдпрд╛рджреА", lblSelectClass: "рд╡рд░реНрдЧрд╛рдиреБрд╕рд╛рд░ рдпрд╛рджреА рдкрд╣рд╛:", optDefault: "-- рд╡рд░реНрдЧ рдирд┐рд╡рдбрд╛ --",
                thName: "рдирд╛рд╡", thParentPhone: "рдкрд╛рд▓рдХрд╛рдВрдЪрд╛ рдлреЛрди", thStudentPhone: "рд╡рд┐рджреНрдпрд╛рд░реНрдереНрдпрд╛рдЪрд╛ рдлреЛрди", thDOB: "рдЬрдиреНрдорддрд╛рд░реАрдЦ", thAction: "рдХреГрддреА", initialMsg: "рдХреГрдкрдпрд╛ рд╡рд░реНрдЧ рдирд┐рд╡рдбрд╛...",
                loader: "рдорд╛рд╣рд┐рддреА рд▓реЛрдб рд╣реЛрдд рдЖрд╣реЗ...", noData: "рдпрд╛ рд╡рд░реНрдЧрд╛рдд рдЕрджреНрдпрд╛рдк рдХреЛрдгреАрд╣реА рд╡рд┐рджреНрдпрд╛рд░реНрдереА рдирд╛рд╣реА.", alertError: "рдбреЗрдЯрд╛ рд▓реЛрдб рдХрд░рддрд╛рдирд╛ рддреНрд░реБрдЯреА рдЖрд▓реА!", langBtn: "English",
                confirmDelete: "рддреБрдореНрд╣рд╛рд▓рд╛ рдЦрд╛рддреНрд░реА рдЖрд╣реЗ рдХреА рддреБрдореНрд╣реА рд╣рд╛ рд╡рд┐рджреНрдпрд╛рд░реНрдереА рд╣рдЯрд╡реВ рдЗрдЪреНрдЫрд┐рддрд╛?", deleteSuccess: "рд╡рд┐рджреНрдпрд╛рд░реНрдереА рдпрд╢рд╕реНрд╡реАрд░рд┐рддреНрдпрд╛ рд╣рдЯрд╡рд▓рд╛ рдЧреЗрд▓рд╛!"
            },
            en: {
                sideTitle: "Yashodeep Classes", navNewAdm: "ЁЯУЭ New Admission", navStudentList: "ЁЯУЛ Student List", navAttendance: "ЁЯУЕ Attendance", navResults: "ЁЯУК Marks/Results", navFees: "ЁЯТ░ Fee Records", navExpenses: "ЁЯТ╕ Expenses", navLogout: "ЁЯЪк Log Out",
                pageTitle: "Registered Student List", lblSelectClass: "View List by Class:", optDefault: "-- Select Class --",
                thName: "Name", thParentPhone: "Parent Phone", thStudentPhone: "Student Phone", thDOB: "Date of Birth", thAction: "Action", initialMsg: "Please select a class...",
                loader: "Loading data...", noData: "No students found in this class.", alertError: "Error loading data!", langBtn: "рдорд░рд╛рдареА",
                confirmDelete: "Are you sure you want to delete this student?", deleteSuccess: "Student deleted successfully!"
            }
        };

        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxj47Qjn7ECezEWf5yfBLG6HFXIc9goq_Jg8CaE48L4BV2pXuZuu9m5nN7vEhh7H0I96Q/exec";

        document.addEventListener("DOMContentLoaded", function() {
            if (sessionStorage.getItem("isLoggedIn") !== "true") { window.location.href = "index.html"; return; }
            const role = sessionStorage.getItem("userRole");
            if (role === "md") {
                document.getElementById("navFees").style.display = "none";
                document.getElementById("navExpenses").style.display = "none";
            }
            updateLanguageUI();
        });

        function toggleLang() {
            currentLang = (currentLang === 'mr') ? 'en' : 'mr';
            sessionStorage.setItem("lang", currentLang);
            updateLanguageUI();
            if(document.getElementById('classSelect').value) loadClassData();
        }

        function updateLanguageUI() {
            const t = langData[currentLang];
            for (let id in t) {
                const el = document.getElementById(id);
                if (el) el.innerText = t[id];
            }
        }

        async function loadClassData() {
            const selectedClass = document.getElementById('classSelect').value;
            const tableBody = document.getElementById('tableBody');
            const loader = document.getElementById('loader');
            const t = langData[currentLang];

            if (!selectedClass) {
                tableBody.innerHTML = `<tr><td colspan="6" style="text-align:center;">${t.initialMsg}</td></tr>`;
                return;
            }

            loader.style.display = "inline";
            tableBody.innerHTML = "";

            try {
                const response = await fetch(`${SCRIPT_URL}?action=read&className=Class ${selectedClass}`);
                const data = await response.json();

                if (!data || data.length === 0) {
                    tableBody.innerHTML = `<tr><td colspan="6" style="text-align:center;">${t.noData}</td></tr>`;
                } else {
                    data.forEach(student => {
                        const tr = document.createElement('tr');
                        
                        let formattedDOB = "-";
                        if (student.dob) {
                            const dateObj = new Date(student.dob);
                            if (!isNaN(dateObj)) {
                                const day = String(dateObj.getDate()).padStart(2, '0');
                                const month = String(dateObj.getMonth() + 1).padStart(2, '0');
                                const year = dateObj.getFullYear();
                                formattedDOB = `${day}/${month}/${year}`;
                            } else {
                                formattedDOB = student.dob;
                            }
                        }

                        tr.innerHTML = `
                            <td>${student.prn || '-'}</td>
                            <td>${student.name || '-'}</td>
                            <td>${student.parentPhone || '-'}</td>
                            <td>${student.studentPhone || '-'}</td> 
                            <td>${formattedDOB}</td> 
                            <td><button class="btn-delete" onclick="deleteStudent('${student.prn}', 'Class ${selectedClass}')">ЁЯЧС Delete</button></td>
                        `;
                        tableBody.appendChild(tr);
                    });
                }
            } catch (error) {
                console.error(error);
                alert(t.alertError);
            } finally {
                loader.style.display = "none";
            }
        }

        async function deleteStudent(prn, className) {
            const t = langData[currentLang];
            if (!confirm(t.confirmDelete)) return;

            document.getElementById('loader').style.display = "inline";

            try {
                const response = await fetch(`${SCRIPT_URL}?action=delete&prn=${prn}&className=${className}`);
                const result = await response.json();
                
                if (result.status === "success") {
                    alert(t.deleteSuccess);
                    loadClassData(); // рдпрд╛рджреА рдкреБрдиреНрд╣рд╛ рд▓реЛрдб рдХрд░рд╛
                } else {
                    alert("Error: " + result.message);
                }
            } catch (error) {
                console.error(error);
                alert(t.alertError);
            } finally {
                document.getElementById('loader').style.display = "none";
            }
        }

        function logout() { sessionStorage.clear(); window.location.href = "index.html"; }
        // --- Keyboard Navigation Script Starts ---
document.addEventListener('keydown', function(e) {
    const active = document.activeElement;
    // рдлрдХреНрдд Input, Select, Textarea рдЖрдгрд┐ Button рд╡рд░рдЪ рд╣реЗ рдХрд╛рдо рдХрд░реЗрд▓
    if (!['INPUT', 'SELECT', 'TEXTAREA', 'BUTTON'].includes(active.tagName)) return;

    // рдлреЙрд░реНрдо рдордзреАрд▓ рд╕рд░реНрд╡ рдШрдЯрдХрд╛рдВрдЪреА рдпрд╛рджреА (рд╕реНрдХрд┐рдк рди рдХрд░рддрд╛)
    const focusableEls = Array.from(document.querySelectorAll('input, select, textarea, button:not(.lang-btn)'));
    const index = focusableEls.indexOf(active);

    switch(e.key) {
        case 'ArrowDown':
            e.preventDefault();
            if (index + 2 < focusableEls.length) focusableEls[index + 2].focus(); // рдЧреНрд░рд┐рдбрдордзреНрдпреЗ рдЦрд╛рд▓реА рдЬрд╛рдгреНрдпрд╛рд╕рд╛рдареА
            else if (index + 1 < focusableEls.length) focusableEls[index + 1].focus();
            break;
            
        case 'ArrowUp':
            e.preventDefault();
            if (index - 2 >= 0) focusableEls[index - 2].focus(); // рдЧреНрд░рд┐рдбрдордзреНрдпреЗ рд╡рд░ рдЬрд╛рдгреНрдпрд╛рд╕рд╛рдареА
            else if (index - 1 >= 0) focusableEls[index - 1].focus();
            break;
            
        case 'ArrowRight':
            e.preventDefault();
            if (index + 1 < focusableEls.length) focusableEls[index + 1].focus();
            break;
            
        case 'ArrowLeft':
            e.preventDefault();
            if (index - 1 >= 0) focusableEls[index - 1].focus();
            break;

        case 'Enter':
            // рдЬрд░ рдмрдЯрдг рдЕрд╕реЗрд▓ рддрд░ рдХреНрд▓рд┐рдХ рд╣реЛрдИрд▓, рдЕрдиреНрдпрдерд╛ рдкреБрдврдЪреНрдпрд╛ рдмреЙрдХреНрд╕рдордзреНрдпреЗ рдЬрд╛рдИрд▓
            if (active.tagName !== 'BUTTON' && active.tagName !== 'TEXTAREA') {
                e.preventDefault();
                if (index + 1 < focusableEls.length) focusableEls[index + 1].focus();
            }
            break;
    }
});
// --- Keyboard Navigation Script Ends ---
    </script>
</body>
</html>
